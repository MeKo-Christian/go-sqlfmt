select id,name,metadata->'profile'->>'email' as email,metadata->'profile'->'social'->>'twitter' as twitter_handle,metadata->'skills' as skills_array,jsonb_array_length(metadata->'skills') as skill_count,metadata->'experience'->>'years' as years_experience,(metadata->'experience'->>'years')::integer as years_experience_int,metadata#>'{profile,social,twitter}' as twitter_path,metadata#>>'{profile,social,twitter}' as twitter_path_text,metadata->'projects'->0->>'name' as first_project_name,jsonb_typeof(metadata->'skills') as skills_type,jsonb_typeof(metadata->'profile') as profile_type,metadata?'skills' as has_skills,metadata?|'array'['skills','experience'] as has_skills_or_experience,metadata?&'array'['profile','skills'] as has_profile_and_skills,metadata->'tags'?'urgent' as has_urgent_tag,metadata->'tags'?|'array'['urgent','important'] as has_urgent_or_important,jsonb_object_keys(metadata->'profile') as profile_keys from users where metadata->'profile'->>'active'='true' and jsonb_array_length(metadata->'skills')>2 order by (metadata->'experience'->>'years')::integer desc;