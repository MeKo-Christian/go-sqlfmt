CREATE VIEW monthly_sales_summary AS WITH monthly_totals AS(SELECT strftime('%Y-%m',sale_date) AS sale_month,product_id,SUM(quantity*unit_price) AS total_sales,SUM(quantity) AS total_quantity,COUNT(*) AS transaction_count FROM sales WHERE sale_date>=date('now','-12 months') GROUP BY strftime('%Y-%m',sale_date),product_id),product_performance AS(SELECT product_id,AVG(total_sales) AS avg_monthly_sales,SUM(total_sales) AS total_yearly_sales,MAX(total_sales) AS best_month_sales,MIN(total_sales) AS worst_month_sales FROM monthly_totals GROUP BY product_id)SELECT mt.sale_month,p.name AS product_name,mt.total_sales,mt.total_quantity,mt.transaction_count,pp.avg_monthly_sales,ROUND((mt.total_sales-pp.avg_monthly_sales)/NULLIF(pp.avg_monthly_sales,0)*100,2) AS sales_vs_avg_percent,CASE WHEN mt.total_sales>pp.avg_monthly_sales*1.2 THEN 'high_performer' WHEN mt.total_sales<pp.avg_monthly_sales*0.8 THEN 'low_performer' ELSE 'average' END AS performance_category FROM monthly_totals mt JOIN products p ON mt.product_id=p.id JOIN product_performance pp ON mt.product_id=pp.product_id ORDER BY mt.sale_month DESC,mt.total_sales DESC;